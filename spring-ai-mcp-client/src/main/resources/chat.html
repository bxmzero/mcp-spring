<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Retro AI Chat (HTTP)</title>
  <style>
    /* ‚Ä¶same styles‚Ä¶ */
    body { margin:0; padding:0; font-family:'Courier New', monospace; background:#1b1b1b; color:#e0e0e0; display:flex; flex-direction:column; align-items:center; height:100vh;}
    body::before { content:''; position:fixed; top:0;left:0;width:100%;height:100%; background:repeating-linear-gradient(0deg,rgba(0,0,0,0),rgba(0,0,0,0) 1px,rgba(0,0,0,0.05) 2px);pointer-events:none;}
    header { width:90%;max-width:1600px;padding:.5rem 1rem;background:#111;border-bottom:2px solid #444;text-align:center;font-size:1.4rem;text-shadow:0 0 4px #0f0;margin-top:.5rem;}
    #chat-window { width:90%;max-width:1600px;flex:1;margin:1rem 0;padding:1rem;overflow-y:auto;background:#222;box-shadow:inset 0 0 10px #000;border:1px solid #444;}
    .message { margin-bottom:1rem; display:flex; align-items:flex-start;}
    .message.user { justify-content:flex-end;}
    .avatar { width:2rem;height:2rem;border-radius:50%;background:#444;margin:0 .5rem;flex-shrink:0;}
    .message.user .avatar { background:#0a74da;}
    .message.ai   .avatar { background:#da740a;}
    .bubble { max-width:80%;padding:.75rem 1rem;border-radius:8px;line-height:1.4;word-wrap:break-word;white-space:pre-wrap;}
    .message.user .bubble { background:#0a74da;color:#fff;border-bottom-right-radius:2px;}
    .message.ai   .bubble { background:#444;border-bottom-left-radius:2px;}
    .timestamp { font-size:.75rem;color:#888;margin-top:.25rem;margin-left:.5rem;}
    #input-form { width:90%;max-width:1600px;display:flex;flex-direction:column;padding:.5rem;background:#111;border-top:2px solid #444;box-shadow:inset 0 0 5px #000;margin-bottom:.5rem;}
    textarea { width:100%;min-height:100px;max-height:200px;padding:.5rem;font-family:inherit;font-size:1rem;border:none;border-radius:4px;resize:vertical;overflow-y:auto;box-shadow:inset 0 0 5px #000;background:#222;color:#e0e0e0;}
    button { align-self:flex-end;margin-top:.5rem;padding:.5rem 1.5rem;font-family:inherit;font-size:1rem;border:none;border-radius:4px;background:#0a74da;color:#fff;cursor:pointer;transition:background .2s;}
    button:hover { background:#085bb5; }
  </style>
</head>
<body>

<header>üïπÔ∏è Retro AI Chat (HTTP)</header>
<div id="chat-window"></div>
<form id="input-form" autocomplete="off">
  <textarea id="user-input" placeholder="Type your message‚Ä¶" required></textarea>
  <button type="submit">Send</button>
</form>

<script>
  const chatWindow = document.getElementById('chat-window');
  const form = document.getElementById('input-form');
  const input = document.getElementById('user-input');

  function fmtTime(d){ return d.toLocaleTimeString([], {hour12:false}); }
  function appendMsg(who, text, label){
    const msg = document.createElement('div');
    msg.className = 'message ' + who;
    msg.innerHTML = `
        <div class="avatar"></div>
        <div>
          <div class="bubble">${text}</div>
          <div class="timestamp">${label}</div>
        </div>`;
    chatWindow.appendChild(msg);
    chatWindow.scrollTop = chatWindow.scrollHeight;
    return msg;
  }

  // Enter to send, Shift+Enter for newline
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      form.requestSubmit();
    }
  });

  form.addEventListener('submit', async e=>{
    e.preventDefault();
    const txt = input.value.trim();
    if(!txt) return;
    const sent = `Sent: ${fmtTime(new Date())}`;
    appendMsg('user', txt, sent);
    input.value = '';

    try {
      const resp = await fetch('/api/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ prompt: txt })
      });
      const body = await resp.json();
      const recv = `Received: ${fmtTime(new Date())}`;
      appendMsg('ai', body.reply, recv);
    } catch {
      appendMsg('ai', '[Error fetching response]', `Received: ${fmtTime(new Date())}`);
    }
  });
</script>
</body>
</html>